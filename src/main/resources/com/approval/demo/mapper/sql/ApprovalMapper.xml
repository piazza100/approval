<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.approval.demo.mapper.ApprovalMapper">

	<select id="getApproval" parameterType="com.approval.demo.domain.ApprovalVO" resultType="com.approval.demo.domain.ApprovalVO">
		SELECT approval_no approvaNo, user_no userNo, admin_user_no adminUserNo, title, content, state, reg_time regTime, mod_time modTime
		  FROM approval.approval
		 where approval_no = #{approvalNo, jdbcType=VARCHAR}
	</select>

	<select id="getApprovalListByUserNo" parameterType="com.approval.demo.domain.ApprovalVO" resultType="com.approval.demo.domain.ApprovalVO">
		SELECT approval_no approvaNo, user_no userNo, admin_user_no adminUserNo, title, content, state, reg_time regTime, mod_time modTime
		  FROM approval.approval
		 where 1=1
		   and user_no = #{userNo, jdbcType=VARCHAR}
		    or admin_user_no = #{userNo, jdbcType=VARCHAR}
		   <if test="approvalNo != null">	
		   and approval_no = #{approvalNo, jdbcType=VARCHAR}
		   </if>
	</select>

	<insert id="addApproval" parameterType="com.approval.demo.domain.ApprovalVO" >
		INSERT INTO approval.approval
		(	
			user_no, admin_user_no, title, content, state, reg_time regTime, mod_time modTime
		)
		VALUES
		( 
			#{userNo}
			,#{adminUserNo}
			,#{title}
			,#{content}
			,'R'
			,now()
			,now()
		 )
	</insert>

	<update id="updateApproval" parameterType="com.approval.demo.domain.ApprovalVO">
		UPDATE approval.approval
		<trim prefix="SET" suffixOverrides=",">
			<if test="state != null">	
			state = #{state},
			</if>
			<if test="title != null">	
			title = #{title},
			</if>
			<if test="content != null">	
			content = #{content},
			</if>
			mod_time = now(),
		</trim>
		where approval_no = #{approvaNo}
	</update>

</mapper>
